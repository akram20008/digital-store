<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</title>

<style>
body{
  margin:0;
  font-family:Tajawal,Tahoma;
  background:#020617;
  color:#fff;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.box{
  width:94%;
  max-width:460px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:22px;
  padding:22px;
  animation:fade .6s ease;
}

@keyframes fade{
  from{opacity:0;transform:translateY(30px)}
}

h2{text-align:center;margin-bottom:16px}

.info{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  padding:14px;
  margin-bottom:16px;
}

.pay{
  border:1px solid #1e293b;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  cursor:pointer;
  transition:.3s;
}

.pay.active{
  border-color:#4ade80;
  background:#022c22;
}

.details{
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  background:#020617;
  border:1px dashed #334155;
  font-size:14px;
  display:none;
  animation:open .3s ease;
}

@keyframes open{
  from{opacity:0;transform:scale(.95)}
}

.upload{
  margin-top:14px;
}

button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#2563eb;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

button:active{
  transform:scale(.97);
}

.back{
  margin-top:12px;
  text-align:center;
  color:#93c5fd;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box">
  <h2>ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</h2>

  <div class="info">
    ğŸ“¦ Ø§Ù„Ø®Ø¯Ù…Ø©: <b id="serviceName"></b><br>
    ğŸ’° Ø§Ù„Ø³Ø¹Ø±: <b>$<span id="servicePrice"></span></b>
  </div>

  <div class="pay" onclick="selectPay(this,'Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†')">
    ğŸ¦ Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†
    <div class="details">
      Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯<br>
      Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 123456789
    </div>
  </div>

  <div class="pay" onclick="selectPay(this,'Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©')">
    ğŸ“± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©
    <div class="details">
      Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯<br>
      Ø§Ù„Ø±Ù‚Ù…: 0590000000
    </div>
  </div>

  <div class="pay" onclick="selectPay(this,'PayPal')">
    ğŸ’³ PayPal
    <div class="details">
      Ø§Ù„Ø¨Ø±ÙŠØ¯: payments@store.com
    </div>
  </div>

  <div class="pay" onclick="selectPay(this,'Ø¬ÙˆØ§Ù„ Ø¨Ø§ÙŠ')">
    ğŸ“ Ø¬ÙˆØ§Ù„ Ø¨Ø§ÙŠ
    <div class="details">
      Ø§Ù„Ø§Ø³Ù…: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯<br>
      Ø§Ù„Ø±Ù‚Ù…: 0560000000
    </div>
  </div>

  <div class="upload">
    ğŸ“· Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
    <input type="file" id="proof" accept="image/*">
  </div>

  <button onclick="confirmOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
  <div class="back" onclick="location.href='index.html'">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAkVr83u7Oxy-lWvqWlCqyVjIS34J-FRd4",
  authDomain:"digital-store-268a9.firebaseapp.com",
  projectId:"digital-store-268a9",
  storageBucket:"digital-store-268a9.appspot.com"
});

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser = null;
let paymentMethod = "";

auth.onAuthStateChanged(user=>{
  currentUser = user;
});

serviceName.textContent = localStorage.getItem("serviceName") || "-";
servicePrice.textContent = localStorage.getItem("servicePrice") || "0";

function selectPay(el,method){
  document.querySelectorAll(".pay").forEach(p=>{
    p.classList.remove("active");
    p.querySelector(".details").style.display="none";
  });
  el.classList.add("active");
  el.querySelector(".details").style.display="block";
  paymentMethod = method;
}

async function confirmOrder(){
  if(!currentUser){
    alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const file = proof.files[0];
  if(!paymentMethod || !file){
    alert("Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
    return;
  }

  const ref = storage.ref("proofs/"+Date.now()+"_"+file.name);
  await ref.put(file);
  const imageURL = await ref.getDownloadURL();

  await db.collection("orders").add({
    service: localStorage.getItem("serviceName"),
    price: localStorage.getItem("servicePrice"),
    paymentMethod,
    proofImage: imageURL,
    email: currentUser.email,
    status:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
  location.href="orders.html";
}
</script>

</body>
</html>
