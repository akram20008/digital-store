<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</title>

<style>
body{
  margin:0;
  font-family:Tajawal,Tahoma;
  background:#020617;
  color:#fff;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.box{
  width:95%;
  max-width:480px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:24px;
  padding:24px;
  animation:fade .6s ease;
}
@keyframes fade{
  from{opacity:0;transform:translateY(40px)}
}

h2{text-align:center;margin-bottom:16px}

.pay{
  background:#111827;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  cursor:pointer;
}
.pay.active{
  background:#022c22;
  border:1px solid #4ade80;
}

.details{
  margin-top:12px;
  padding:12px;
  border:1px dashed #334155;
  border-radius:14px;
  display:none;
}

input[type=file]{
  margin-top:14px;
  width:100%;
  color:#fff;
}

.preview{
  margin-top:10px;
}
.preview img{
  width:100%;
  border-radius:14px;
  max-height:220px;
  object-fit:cover;
}

button{
  width:100%;
  margin-top:16px;
  padding:14px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box">
  <h2>ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</h2>

  <p>ğŸ“¦ Ø§Ù„Ø®Ø¯Ù…Ø©: <b id="serviceName"></b></p>
  <p>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: <b>$<span id="servicePrice"></span></b></p>

  <div class="pay" onclick="selectPay(this,'bank')">ğŸ¦ Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†</div>
  <div class="pay" onclick="selectPay(this,'wallet')">ğŸ“± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
  <div class="pay" onclick="selectPay(this,'paypal')">ğŸ’³ PayPal</div>
  <div class="pay" onclick="selectPay(this,'jawwal')">ğŸ“ Ø¬ÙˆØ§Ù„ Ø¨Ø§ÙŠ</div>

  <div class="details" id="detailsBox"></div>

  <!-- Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø«Ø¨Ø§Øª -->
  <input type="file" accept="image/*" id="proofInput">
  <div class="preview" id="preview"></div>

  <button onclick="confirmOrder()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAkVr83u7Oxy-lWvqWlCqyVjIS34J-FRd4",
  authDomain:"digital-store-268a9.firebaseapp.com",
  projectId:"digital-store-268a9",
  storageBucket:"digital-store-268a9.appspot.com"
});

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

const serviceName=localStorage.getItem("serviceName");
const servicePrice=localStorage.getItem("servicePrice");
document.getElementById("serviceName").textContent=serviceName;
document.getElementById("servicePrice").textContent=servicePrice;

let paymentMethod="";
const detailsBox=document.getElementById("detailsBox");
const proofInput=document.getElementById("proofInput");
const preview=document.getElementById("preview");

function selectPay(el,type){
  document.querySelectorAll(".pay").forEach(p=>p.classList.remove("active"));
  el.classList.add("active");
  detailsBox.style.display="block";

  if(type==="bank"){
    paymentMethod="Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†";
    detailsBox.innerHTML="Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: <b>1234567890</b>";
  }
  if(type==="wallet"){
    paymentMethod="Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©";
    detailsBox.innerHTML="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©: <b>0599123456</b>";
  }
  if(type==="paypal"){
    paymentMethod="PayPal";
    detailsBox.innerHTML="PayPal: <b>payments@digitalstore.com</b>";
  }
  if(type==="jawwal"){
    paymentMethod="Ø¬ÙˆØ§Ù„ Ø¨Ø§ÙŠ";
    detailsBox.innerHTML="Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø¨Ø§ÙŠ: <b>0599876543</b>";
  }
}

/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© */
proofInput.onchange=()=>{
  const file=proofInput.files[0];
  if(file){
    preview.innerHTML=`<img src="${URL.createObjectURL(file)}">`;
  }
}

/* ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ */
async function confirmOrder(){
  const user=auth.currentUser;
  if(!user){alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„");return;}
  if(!paymentMethod){alert("Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹");return;}
  if(!proofInput.files[0]){alert("Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹");return;}

  const file=proofInput.files[0];
  const ref=storage.ref("proofs/"+Date.now()+"_"+file.name);
  await ref.put(file);
  const imageURL=await ref.getDownloadURL();

  await db.collection("orders").add({
    email:user.email,
    service:serviceName,
    price:servicePrice,
    paymentMethod,
    proofImage:imageURL,
    status:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
  location.href="orders.html";
}
</script>

</body>
</html>
