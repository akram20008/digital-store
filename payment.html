<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</title>

<style>
body{
  margin:0;
  font-family:Tajawal,Tahoma;
  background:#020617;
  color:#fff;
}

.container{
  max-width:520px;
  margin:60px auto;
  padding:20px;
}

.card{
  background:linear-gradient(160deg,rgba(255,255,255,.15),rgba(255,255,255,.05));
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:25px;
  box-shadow:0 30px 70px rgba(0,0,0,.6);
  animation:fadeUp .8s ease;
}

h2{
  text-align:center;
  margin-bottom:25px;
}

.row{
  margin-bottom:18px;
}

.label{
  font-size:14px;
  color:#cbd5f5;
  margin-bottom:6px;
}

select,input[type=file]{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  background:#020617;
  color:#fff;
}

.payment-box{
  background:#020617;
  border-radius:16px;
  padding:14px;
  font-size:14px;
  line-height:1.8;
  margin-top:10px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  font-size:16px;
  cursor:pointer;
  transition:.3s;
}

button:hover{
  transform:scale(1.05);
  box-shadow:0 0 35px rgba(37,99,235,.7);
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h2>ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</h2>

    <div class="row">
      <div class="label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
      <select id="method" onchange="showInfo()">
        <option value="">-- Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ --</option>
        <option value="bank">ğŸ¦ Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†</option>
        <option value="wallet">ğŸ“± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option>
      </select>
    </div>

    <div id="info" class="payment-box" style="display:none"></div>

    <div class="row">
      <div class="label">Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</div>
      <input type="file" id="receipt" accept="image/*">
    </div>

    <button onclick="confirmPayment()">ğŸ“¤ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAkVr83u7Oxy-lWvqWlCqyVjIS34J-FRd4",
  authDomain:"digital-store-268a9.firebaseapp.com",
  projectId:"digital-store-268a9"
});

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

const params=new URLSearchParams(location.search);
const orderId=params.get("order");

if(!orderId){
  alert("âŒ Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­");
  location.href="index.html";
}

function showInfo(){
  const v=method.value;
  info.style.display="block";
  if(v==="bank"){
    info.innerHTML=`
      Ø¨Ù†Ùƒ ÙÙ„Ø³Ø·ÙŠÙ†<br>
      Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯: Ù…ØªØ¬Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©<br>
      Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 123456789
    `;
  }else if(v==="wallet"){
    info.innerHTML=`
      Ù…Ø­ÙØ¸Ø© PalPay<br>
      Ø§Ù„Ø±Ù‚Ù…: 0590000000<br>
      Ø§Ù„Ø§Ø³Ù…: Ù…ØªØ¬Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª
    `;
  }else{
    info.style.display="none";
  }
}

function confirmPayment(){
  const file=receipt.files[0];
  const m=method.value;

  if(!m || !file){
    alert("âŒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
    return;
  }

  const ref=storage.ref("receipts/"+orderId+".jpg");

  ref.put(file)
  .then(()=>ref.getDownloadURL())
  .then(url=>{
    return db.collection("orders").doc(orderId).update({
      paymentMethod:m,
      receipt:url,
      status:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯ÙØ¹"
    });
  })
  .then(()=>{
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹");
    location.href="orders.html";
  })
  .catch(err=>{
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£");
    console.error(err);
  });
}
</script>

</body>
  </html>
