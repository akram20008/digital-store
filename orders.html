<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø·Ù„Ø¨Ø§ØªÙŠ</title>

<style>
body{
  margin:0;
  font-family:Tajawal,Tahoma;
  background:#020617;
  color:#fff;
}
header{
  padding:16px 20px;
  background:#020617;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #1e293b;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
}
.card img{
  width:100%;
  max-height:220px;
  object-fit:cover;
  border-radius:12px;
  margin-top:12px;
}
.status{
  margin-top:8px;
  color:#4ade80;
}
.back{
  color:#93c5fd;
  cursor:pointer;
}
.admin-clear{
  background:#dc2626;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:12px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div class="back" onclick="location.href='index.html'">â¬… Ø§Ù„Ù…ØªØ¬Ø±</div>
  <h3>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
  <button id="clearBtn" class="admin-clear" style="display:none">
    ğŸ—‘ ØªÙØ±ÙŠØº Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  </button>
</header>

<div class="container" id="orders"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAkVr83u7Oxy-lWvqWlCqyVjIS34J-FRd4",
  authDomain:"digital-store-268a9.firebaseapp.com",
  projectId:"digital-store-268a9"
});

const auth = firebase.auth();
const db = firebase.firestore();
const box = document.getElementById("orders");
const clearBtn = document.getElementById("clearBtn");

const ADMINS = ["admin@admin.com","admin2@admin.com"];

auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
    return;
  }

  // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªÙØ±ÙŠØº Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
  if(ADMINS.includes(user.email)){
    clearBtn.style.display="block";
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  db.collection("orders")
    .where("email","==",user.email)
    .onSnapshot(snap=>{
      box.innerHTML="";

      if(snap.empty){
        box.innerHTML="<p>âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>";
        return;
      }

      snap.forEach(doc=>{
        const o = doc.data();
        box.innerHTML += `
          <div class="card">
            <b>ğŸ“¦ ${o.service}</b><br>
            ğŸ’° Ø§Ù„Ø³Ø¹Ø±: $${o.price || "-"}<br>
            ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${o.paymentMethod || "-"}<br>
            <div class="status">ğŸ“Œ ${o.status || "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"}</div>
            ${o.proofImage ? `<img src="${o.proofImage}">` : ""}
          </div>
        `;
      });
    });
});

// ØªÙØ±ÙŠØº Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·)
clearBtn.onclick = async ()=>{
  if(!confirm("âš  Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ")) return;

  const snap = await db.collection("orders").get();
  const batch = db.batch();

  snap.forEach(doc=>{
    batch.delete(doc.ref);
  });

  await batch.commit();
  alert("âœ… ØªÙ… ØªÙØ±ÙŠØº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª");
};
</script>

</body>
</html>
