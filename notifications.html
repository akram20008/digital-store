<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ðŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>

<style>
body{
  margin:0;
  font-family:Tahoma;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:#fff;
  min-height:100vh;
}
.container{
  max-width:900px;
  margin:auto;
  padding:30px 15px;
  animation:fadeIn .8s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(40px)}
  to{opacity:1;transform:none}
}

h1{
  text-align:center;
  margin-bottom:25px;
}

.top{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:25px;
}

button{
  padding:10px 18px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  font-size:14px;
  color:#fff;
}

.back{background:#16a34a}
.clear{background:#dc2626}

.notify{
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(12px);
  border-radius:18px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
  animation:pop .5s ease;
  position:relative;
}

@keyframes pop{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}

.notify.unread{
  border-right:6px solid #38bdf8;
}

.time{
  font-size:12px;
  opacity:.7;
  margin-top:6px;
}

.empty{
  text-align:center;
  opacity:.7;
  margin-top:60px;
}
</style>
</head>

<body>

<div class="container">
  <h1>ðŸ”” Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙƒ</h1>

  <div class="top">
    <button class="back" onclick="location.href='index.html'">ðŸ›’ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</button>
    <button class="clear" onclick="markAllRead()">âœ” ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
  </div>

  <div id="list"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAkVr83u7Oxy-lWvqWlCqyVjIS34J-FRd4",
  authDomain:"digital-store-268a9.firebaseapp.com",
  projectId:"digital-store-268a9"
});

const auth=firebase.auth();
const db=firebase.firestore();
const list=document.getElementById("list");

let currentEmail=null;

/* Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
    return;
  }
  currentEmail=user.email;
  loadNotifications();
});

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
function loadNotifications(){
  db.collection("notifications")
    .where("email","==",currentEmail)
    .orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      list.innerHTML="";
      if(snapshot.empty){
        list.innerHTML=`<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ ðŸ”•</div>`;
        return;
      }
      snapshot.forEach(doc=>{
        const n=doc.data();
        list.innerHTML+=`
          <div class="notify ${n.read?'':'unread'}">
            ${n.message}
            <div class="time">
              ${n.createdAt?.toDate().toLocaleString('ar')}
            </div>
          </div>
        `;
      });
    });
}

/* ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡ */
function markAllRead(){
  db.collection("notifications")
    .where("email","==",currentEmail)
    .where("read","==",false)
    .get()
    .then(snap=>{
      snap.forEach(doc=>{
        doc.ref.update({read:true});
      });
    });
}
</script>

</body>
  </html>
